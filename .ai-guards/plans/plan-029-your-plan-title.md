---
id: plan-029
title: Implementa√ß√£o de Transcri√ß√£o em Tempo Real - Screen Sharing
createdAt: 2025-06-27
author: theplayzzz
status: in-progress
---

## üß© Scope

Implementar um sistema de transcri√ß√£o em tempo real de √°udio de tela compartilhada na rota `/coach/capture` da aplica√ß√£o principal, baseado no reposit√≥rio subtitle-chan. O sistema deve capturar √°udio da tela compartilhada e transcrever usando a Web Speech API nativa do browser.

## ‚úÖ Functional Requirements

- Bot√£o "Compartilhar Tela" que inicia captura de √°udio da tela
- Transcri√ß√£o em tempo real do √°udio capturado
- Interface para exibir transcri√ß√µes ao vivo
- Controles de in√≠cio/parada da transcri√ß√£o
- Tratamento de erros e reconex√£o autom√°tica
- Integra√ß√£o com Web Speech API nativa do browser
- P√°gina acess√≠vel em `/coach/capture` (n√£o listada no menu principal)

## ‚öôÔ∏è Non-Functional Requirements

- Performance: Transcri√ß√£o com lat√™ncia m√°xima de 2 segundos
- Security: Dados de √°udio processados apenas no browser (n√£o enviados para servidor)
- Scalability: Suporte a m√∫ltiplas sess√µes simult√¢neas
- Usability: Interface intuitiva com feedback visual claro
- Compatibility: Funcionar em Chrome, Edge (Web Speech API suportada, requer internet)
- Limitation: Firefox n√£o suporta Speech Recognition

## üìö Guidelines & Packages

- Follow project guidelines: Next.js 15, TypeScript, Tailwind CSS
- Packages do subtitle-chan: React, TypeScript, Vite, Tailwind (MIT License)
- Web Speech API nativa do browser
- Web API: getDisplayMedia() para captura de tela
- Sem depend√™ncias externas de transcri√ß√£o

## üîê Threat Model (Stub)

- Audio data privacy: Dados processados apenas no browser, n√£o armazenados
- Screen sharing permission: Usu√°rio deve autorizar captura de tela
- Browser compatibility: Verificar suporte √† Web Speech API
- Resource exhaustion: Limitar dura√ß√£o m√°xima de sess√µes
- Internet dependency: Chrome requer conex√£o para Speech Recognition

## ‚ö†Ô∏è Desafios T√©cnicos Identificados

- **Web Speech API + Screen Sharing**: SpeechRecognition normalmente s√≥ funciona com getUserMedia()
- **Compatibilidade**: Firefox n√£o suporta Speech Recognition
- **Offline**: Chrome requer servidor para reconhecimento
- **Integra√ß√£o**: Necess√°rio MediaRecorder para conectar √°udio da tela ao SpeechRecognition

## üî¢ Execution Plan

### **Etapa 1: Setup e Clone do Reposit√≥rio Base** ‚úÖ
- [x] Clonar subtitle-chan em diret√≥rio tempor√°rio
- [x] Analisar estrutura do projeto e arquivos principais
- [x] Identificar componentes React reutiliz√°veis
- [x] Extrair bibliotecas e utilit√°rios necess√°rios
- [x] Documentar arquitetura e fluxo de dados

### **Etapa 2: Cria√ß√£o da Estrutura Base** ‚úÖ
- [x] Criar p√°gina `/coach/capture` no Next.js
- [x] Configurar rota protegida (n√£o listada)
- [x] Implementar layout b√°sico da p√°gina
- [x] Configurar componentes base extra√≠dos do subtitle-chan
- [x] Teste: P√°gina acess√≠vel e renderizando corretamente

### **Etapa 3: Implementa√ß√£o de Screen Sharing** ‚úÖ
- [x] Adaptar componente AudioRecorder para getDisplayMedia()
- [x] Investigar como conectar √°udio da tela ao SpeechRecognition
- [x] Implementar MediaRecorder para processamento de √°udio
- [x] Adicionar controles de in√≠cio/parada
- [x] Implementar preview da tela compartilhada
- [x] Teste: Captura de √°udio da tela funcionando

**Implementa√ß√µes realizadas na Etapa 3:**
- ‚úÖ **Preview da tela compartilhada**: Video element com stream em tempo real
- ‚úÖ **MediaRecorder**: Grava√ß√£o de √°udio em chunks de 1 segundo
- ‚úÖ **AudioContext**: Processamento de √°udio da tela compartilhada
- ‚úÖ **Download de √°udio**: Funcionalidade para baixar √°udio gravado (.webm)
- ‚úÖ **Controles aprimorados**: Bot√µes com √≠cones e estados visuais melhorados
- ‚úÖ **Verifica√ß√£o de compatibilidade**: Detec√ß√£o de getDisplayMedia() e Web Speech API
- ‚úÖ **Cleanup autom√°tico**: Libera√ß√£o de recursos ao parar captura
- ‚úÖ **Interface responsiva**: Design seguindo paleta de cores do projeto

### **Etapa 4: Integra√ß√£o com Web Speech API do subtitle-chan**
- [ ] Implementar prefixos de compatibilidade (webkit)
- [ ] Configurar SpeechRecognition: continuous=true, lang='pt-BR', interimResults=true
- [ ] Adaptar componente de transcri√ß√£o do subtitle-chan
- [ ] Implementar eventos: onresult, onstart, onend, onerror
- [ ] Implementar reconex√£o autom√°tica (onend)
- [ ] Adicionar controles de configura√ß√£o (idioma, etc.)
- [ ] Implementar tratamento de erros espec√≠ficos
- [ ] Teste: Transcri√ß√£o funcionando com screen sharing

### **Etapa 5: Melhorias de Interface**
- [ ] Implementar design responsivo
- [ ] Adicionar indicadores visuais de status
- [ ] Implementar hist√≥rico de transcri√ß√µes
- [ ] Adicionar op√ß√µes de configura√ß√£o avan√ßadas
- [ ] Teste: Interface completa e polida

### **Etapa 6: Otimiza√ß√£o e Testes Finais**
- [ ] Otimizar performance da transcri√ß√£o
- [ ] Implementar tratamento robusto de erros
- [ ] Adicionar logs para debugging
- [ ] Testes em diferentes navegadores
- [ ] Teste: Sistema completo funcionando

### **Etapa 7: Documenta√ß√£o e Deploy**
- [ ] Documentar setup e funcionamento
- [ ] Criar guia de uso para desenvolvedores
- [ ] Preparar deploy da funcionalidade
- [ ] Teste: Sistema em produ√ß√£o

## üìã Arquivos Principais a Criar/Modificar

### **Frontend (Next.js)**
```
app/coach/capture/
‚îú‚îÄ‚îÄ page.tsx                 # P√°gina principal ‚úÖ
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ScreenRecorder.tsx   # Componente adaptado do subtitle-chan ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ TranscriptionDisplay.tsx ‚úÖ
‚îÇ   ‚îú‚îÄ‚îÄ AudioControls.tsx ‚úÖ
‚îÇ   ‚îî‚îÄ‚îÄ StatusIndicator.tsx
‚îî‚îÄ‚îÄ lib/
    ‚îú‚îÄ‚îÄ audioUtils.ts        # Utilit√°rios de √°udio
    ‚îî‚îÄ‚îÄ useScreenTranscription.ts ‚úÖ
```

### **Configura√ß√£o**
```
next.config.js              # Configura√ß√£o do Next.js (se necess√°rio)
```

## üéØ Crit√©rios de Sucesso por Etapa

1. **Etapa 1**: ‚úÖ Compreens√£o clara da arquitetura do subtitle-chan
2. **Etapa 2**: ‚úÖ P√°gina `/coach/capture` acess√≠vel e funcional
3. **Etapa 3**: ‚úÖ Captura de √°udio da tela compartilhada
4. **Etapa 4**: Transcri√ß√£o em tempo real com Web Speech API
5. **Etapa 5**: Interface completa e responsiva
6. **Etapa 6**: Sistema robusto e otimizado
7. **Etapa 7**: Funcionalidade pronta para produ√ß√£o

## üöÄ Comandos Iniciais

```bash
# Clonar subtitle-chan para an√°lise
git clone https://github.com/ae9is/subtitle-chan.git temp/subtitle-chan

# Instalar depend√™ncias se necess√°rio
cd temp/subtitle-chan && npm install

# Executar para entender funcionamento
npm run dev
```

## üîß Configura√ß√µes Web Speech API Necess√°rias

```javascript
// Compatibilidade cross-browser
const SpeechRecognition = 
  window.SpeechRecognition || window.webkitSpeechRecognition;

// Configura√ß√£o para transcri√ß√£o cont√≠nua
recognition.continuous = true;        // N√£o para automaticamente
recognition.lang = 'pt-BR';          // Portugu√™s brasileiro
recognition.interimResults = true;    // Resultados parciais em tempo real
recognition.maxAlternatives = 1;      // Uma alternativa por resultado

// Eventos essenciais
recognition.onresult = (event) => {
  // Processar transcri√ß√£o em tempo real
};
recognition.onend = () => {
  // Reiniciar automaticamente para transcri√ß√£o cont√≠nua
  recognition.start();
};
```

## üìä Status Atual

**Progresso**: 3/7 etapas conclu√≠das (43%)
**Pr√≥xima**: Etapa 4 - Integra√ß√£o com Web Speech API do subtitle-chan
**Estimativa**: 2-3 etapas restantes para MVP funcional

# Plano de Implementa√ß√£o: Sistema de Transcri√ß√£o em Tempo Real

## Status: üîÑ Em Progresso - Etapa 3 Conclu√≠da com Corre√ß√£o HTTPS

### Contexto
Implementar um sistema de transcri√ß√£o em tempo real de √°udio de tela compartilhada na rota `/coach/capture` usando Web Speech API nativa do navegador.

### Decis√µes Tomadas
- ‚úÖ **Usar Web Speech API nativa** em vez de Google Cloud Speech-to-Text API
- ‚úÖ **Arquitetura baseada no subtitle-chan** (React + TypeScript + Tailwind)
- ‚úÖ **Configura√ß√£o HTTPS obrigat√≥ria** para APIs de m√≠dia

### Etapas do Projeto

#### ‚úÖ Etapa 1: An√°lise e Estrutura√ß√£o (Conclu√≠da)
- [x] An√°lise do subtitle-chan como base arquitetural
- [x] Mapeamento de componentes e funcionalidades
- [x] Defini√ß√£o da stack tecnol√≥gica

#### ‚úÖ Etapa 2: Implementa√ß√£o Base (Conclu√≠da)
- [x] Cria√ß√£o da estrutura de diret√≥rios
- [x] Instala√ß√£o de depend√™ncias
- [x] Implementa√ß√£o dos componentes base
- [x] Configura√ß√£o de rota e middleware

#### ‚úÖ Etapa 3: Screen Sharing + HTTPS (Conclu√≠da)
- [x] Implementa√ß√£o de getDisplayMedia()
- [x] Preview em tempo real da tela compartilhada
- [x] MediaRecorder para grava√ß√£o de √°udio
- [x] Download de √°udio gravado
- [x] **üîí CORRE√á√ÉO HTTPS**: Configura√ß√£o SSL para desenvolvimento
- [x] **üõ†Ô∏è Scripts de automa√ß√£o**: setup-https.sh e dev:https
- [x] **üìö Documenta√ß√£o**: TRANSCRICAO-README.md

**Problema Identificado e Resolvido:**
- **Causa**: APIs de m√≠dia (getDisplayMedia, getUserMedia) requerem HTTPS
- **Solu√ß√£o**: Certificados SSL autoassinados + servidor HTTPS personalizado
- **Comandos**: `./setup-https.sh` e `npm run dev:https`

#### üîÑ Etapa 4: Integra√ß√£o Web Speech API (Pr√≥xima)
- [ ] Configura√ß√£o completa da Web Speech API
- [ ] Processamento de √°udio da tela compartilhada
- [ ] Transcri√ß√£o em tempo real
- [ ] Tratamento de erros e reconex√£o

#### ‚è≥ Etapa 5: Processamento Avan√ßado
- [ ] Sistema de frases autom√°tico
- [ ] Controle de qualidade da transcri√ß√£o
- [ ] Configura√ß√µes personaliz√°veis
- [ ] Otimiza√ß√µes de performance

#### ‚è≥ Etapa 6: Exporta√ß√£o e Hist√≥rico
- [ ] Exporta√ß√£o de transcri√ß√µes (TXT, JSON)
- [ ] Hist√≥rico de sess√µes
- [ ] Marcadores de tempo
- [ ] Metadados da sess√£o

#### ‚è≥ Etapa 7: Testes e Otimiza√ß√µes
- [ ] Testes de compatibilidade
- [ ] Otimiza√ß√µes de performance
- [ ] Tratamento de edge cases
- [ ] Documenta√ß√£o final

### Arquitetura Implementada

```
app/coach/capture/
‚îú‚îÄ‚îÄ page.tsx                    # P√°gina principal
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ScreenRecorder.tsx      # Componente principal
‚îÇ   ‚îú‚îÄ‚îÄ TranscriptionDisplay.tsx # Exibi√ß√£o de transcri√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ AudioControls.tsx       # Controles de interface
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ useScreenTranscription.ts # Hook de transcri√ß√£o

# Configura√ß√£o HTTPS
‚îú‚îÄ‚îÄ server-https.js             # Servidor HTTPS personalizado
‚îú‚îÄ‚îÄ setup-https.sh              # Script de configura√ß√£o
‚îî‚îÄ‚îÄ .ssl/                       # Certificados SSL (ignorado pelo Git)
```

### Tecnologias Utilizadas
- **Framework**: Next.js 15
- **Linguagem**: TypeScript
- **Estiliza√ß√£o**: Tailwind CSS + Paleta de cores customizada
- **APIs**: Web Speech API + Screen Capture API
- **Grava√ß√£o**: MediaRecorder API
- **Seguran√ßa**: HTTPS com certificados autoassinados

### Como Executar
```bash
# Configurar HTTPS (primeira vez)
./setup-https.sh

# Executar com HTTPS (obrigat√≥rio)
npm run dev:https

# Acessar
https://localhost:3003/coach/capture
```

### Requisitos de Compatibilidade
- **Navegador**: Chrome 74+ ou Edge 79+
- **Protocolo**: HTTPS (obrigat√≥rio)
- **Conex√£o**: Internet (para Web Speech API)
- **Permiss√µes**: Compartilhamento de tela

### Progresso Atual
**3/7 etapas conclu√≠das (43%)**

**Funcionalidades Implementadas:**
- ‚úÖ Compartilhamento de tela com √°udio
- ‚úÖ Preview em tempo real
- ‚úÖ Grava√ß√£o e download de √°udio
- ‚úÖ Interface responsiva
- ‚úÖ Verifica√ß√£o de compatibilidade
- ‚úÖ Configura√ß√£o HTTPS autom√°tica
- ‚úÖ Gest√£o de recursos e cleanup

**Pr√≥ximos Passos:**
1. **Integra√ß√£o completa com Web Speech API** (Etapa 4)
2. **Processamento avan√ßado de transcri√ß√µes** (Etapa 5)
3. **Sistema de exporta√ß√£o** (Etapa 6)

### Observa√ß√µes Importantes
- **HTTPS √© obrigat√≥rio** para todas as APIs de m√≠dia
- **Certificados autoassinados** s√£o seguros para desenvolvimento
- **Web Speech API** processa tudo localmente no navegador
- **Compatibilidade** limitada ao Chrome e Edge por quest√µes de seguran√ßa

---

**√öltima Atualiza√ß√£o**: 05/07/2025 - Corre√ß√£o HTTPS implementada
